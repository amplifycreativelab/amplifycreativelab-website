---
import { Image } from "astro:assets";
import logoWeb from "../assets/images/logo/amplify-creative-lab-logo-perth-WA.svg";

interface MenuItem {
  label: string;
  href: string;
  children?: { label: string; href: string }[];
}

const leftMenu: MenuItem[] = [
  { label: "PORTFOLIO", href: "/portfolio/" },
  {
    label: "SERVICES",
    href: "/#services-container",
    children: [
      { label: "FOOD PHOTOGRAPHY", href: "/perth-food-photography/" },
      { label: "PRODUCT PHOTOGRAPHY", href: "/perth-product-photography/" },
      { label: "EVENT PHOTOGRAPHY", href: "/perth-event-photography/" },
      { label: "WEBSITE DEVELOPMENT", href: "/perth-website-development/" },
    ],
  },
  { label: "ABOUT", href: "/about/" },
];

const rightMenu: MenuItem[] = [
  { label: "BLOG", href: "/blog/" },
  { label: "FAQ", href: "/faq/" },
  { label: "CONTACTS", href: "/contact/" },
];
---

<header class="site-header" id="site-header">
  <div class="site-header-inner">
    <!-- LEFT NAV -->
    <nav class="site-nav site-nav--left" aria-label="Left menu">
      <ul class="site-nav-list">
        {
          leftMenu.map((item) => (
            <li class:list={["site-nav-item", item.children && "has-dropdown"]}>
              <a class="site-nav-link" href={item.href}>
                {item.label}
                {item.children && (
                  <span class="dropdown-caret" aria-hidden="true">
                    &#9662;
                  </span>
                )}
              </a>

              {item.children && (
                <ul class="dropdown">
                  {item.children.map((c) => (
                    <li class="dropdown-item">
                      <a class="dropdown-link" href={c.href}>
                        {c.label}
                      </a>
                    </li>
                  ))}
                </ul>
              )}
            </li>
          ))
        }
      </ul>
    </nav>

    <!-- LOGO (CENTER) -->
    <div class="site-logo">
      <a href="/" aria-label="Amplify Creative Lab home">
        <Image
          src={logoWeb}
          alt="Amplify Creative Lab - Photography and Web Design Perth"
          width="600"
          height="200"
          loading="eager"
          decoding="async"
          fetchpriority="high"
        />
      </a>
    </div>

    <!-- RIGHT NAV -->
    <nav class="site-nav site-nav--right" aria-label="Right menu">
      <ul class="site-nav-list">
        {
          rightMenu.map((item) => (
            <li class:list={["site-nav-item", item.children && "has-dropdown"]}>
              <a class="site-nav-link" href={item.href}>
                {item.label}
                {item.children && (
                  <span class="dropdown-caret" aria-hidden="true">
                    &#9662;
                  </span>
                )}
              </a>

              {item.children && (
                <ul class="dropdown">
                  {item.children.map((c) => (
                    <li class="dropdown-item">
                      <a class="dropdown-link" href={c.href}>
                        {c.label}
                      </a>
                    </li>
                  ))}
                </ul>
              )}
            </li>
          ))
        }
      </ul>
    </nav>

    <!-- MOBILE BURGER -->
    <button
      class="nav-toggle"
      type="button"
      aria-label="Menu"
      aria-controls="mobile-nav"
      aria-expanded="false"
      data-nav-toggle
    >
      <span></span><span></span><span></span>
    </button>
  </div>

  <!-- MOBILE OFFCANVAS -->
  <div class="mobile-nav" id="mobile-nav" data-mobile-nav hidden>
    <div class="mobile-nav-inner">
      <button
        class="mobile-nav-close"
        type="button"
        aria-label="Close menu"
        data-nav-close>&times;</button
      >

      <nav aria-label="Mobile menu">
        <ul class="mobile-nav-list">
          <li class="mobile-nav-item">
            <a class="mobile-nav-link" href="/">HOME</a>
          </li>
          {
            [...leftMenu, ...rightMenu].map((item) => (
              <li
                class:list={[
                  "mobile-nav-item",
                  item.children && "has-dropdown",
                ]}
              >
                <a class="mobile-nav-link" href={item.href}>
                  {item.label}
                </a>
                {item.children && (
                  <ul class="mobile-submenu">
                    {item.children.map((c) => (
                      <li>
                        <a class="mobile-submenu-link" href={c.href}>
                          {c.label}
                        </a>
                      </li>
                    ))}
                  </ul>
                )}
              </li>
            ))
          }
        </ul>
      </nav>
    </div>
  </div>
  <style>
    /* ========== GLOBAL HEADER / NAVBAR (WP clone) ========== */

    .site-header {
      position: sticky;
      top: 0;
      left: 0;
      width: 100%;
      height: 90px;
      /* ct-header / ct-menu-link */
      z-index: 50;
      background: transparent;
      transition:
        transform 0.25s ease,
        background-color 0.25s ease;
    }

    .site-header.is-hidden {
      transform: translateY(-100%);
    }

    .site-header.is-scrolled {
      background: var(--color-bg);
    }

    .site-header-inner {
      /* Make the header container much wider like the original Blocksy header */
      width: min(100%);
      /* matches --theme-normal-container-max-width */
      padding-inline: clamp(24px, 6vw, 130px);
      /* grows with screen, caps at 130px */
      height: 80px;
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
    }

    /* Logo */
    .site-logo img {
      height: 80px;
      width: auto;
      display: block;
      transform: scaleX(1.2); /* 10% wider */
      transform-origin: center;
    }

    /* Desktop nav list */

    .site-nav {
      display: flex;
      width: 100%;
    }

    .site-nav-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      gap: 90px;
      /* space between items */
      align-items: center;
    }

    .site-nav--left {
      justify-content: flex-start;
    }

    .site-nav--right {
      justify-content: flex-end;
    }

    /* ===== TOP LEVEL LINKS (ct-menu-link clone) ===== */
    .site-nav-item {
      position: relative;
    }

    /* Right nav dropdown aligns right like WP */
    .site-nav--right .dropdown {
      left: auto;
      right: 0;
    }

    .site-nav-link {
      display: flex;
      align-items: center;
      justify-content: center;

      height: 90px;
      padding: 0 30px 0 0;

      /* if you want ONLY right padding like before:
     padding: 0 30px 0 0;
  */

      font-family: var(--font-body);
      font-size: 14px;
      font-weight: 300;
      letter-spacing: normal;
      line-height: 18.2px;
      /* computed line-height */
      text-transform: uppercase;
      white-space: nowrap;

      color: #000;
      /* computed --theme-link-initial-color */
      text-decoration: none;

      transition: all 0.12s cubic-bezier(0.455, 0.03, 0.515, 0.955);
    }

    .site-nav--right .site-nav-link {
      padding-right: 0;
      /* reduce empty space at far right */
    }

    .site-nav-link:hover {
      color: #000;
    }

    /* caret */
    .dropdown-caret {
      font-size: 12px;
      margin-left: 6px;
      transform: translateY(-1px);
    }

    /* ===== DROPDOWN PANEL (sub-menu clone) ===== */
    .dropdown {
      position: absolute;
      top: 90px;
      /* exactly under header */
      left: 0;

      width: 250px;
      /* --dropdown-width */
      background: var(--color-bg);

      border-radius: 0 0 2px 2px;
      /* computed */
      list-style: none;
      margin: 0;
      padding: 0;
      /* computed: no padding on panel */
      overflow: hidden;
      z-index: 60;

      box-shadow: 0 10px 20px rgba(41, 51, 61, 0.1);
      /* computed */

      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      transform: translateY(10px);
      /* computed transform */

      transition:
        opacity 0.2s ease,
        visibility 0.2s ease,
        transform 0.2s ease;
    }

    /* show dropdown */
    .has-dropdown:hover > .dropdown,
    .has-dropdown:focus-within > .dropdown {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transform: translateY(0);
    }

    /* ===== DROPDOWN LINKS (sub-menu ct-link clone) ===== */
    .dropdown-link {
      display: block;
      padding: 14px 18px; /* Safe touch target > 48px */
      font-family: var(--font-body);
      font-size: 14px;
      color: var(--color-text);
      /* computed submenu size */
      font-weight: 400;
      /* computed submenu weight */
      line-height: 26.4px;
      /* computed */
      text-transform: none;
      /* computed */
      white-space: nowrap;

      text-decoration: none;

      transition: background 0.2s ease;
    }

    .dropdown-link:hover {
      background: rgba(0, 0, 0, 0.04);
    }

    /* ===============================
   MOBILE TOGGLE (hidden desktop)
   =============================== */
    .nav-toggle {
      display: none;
      justify-self: end;
      width: 44px;
      height: 44px;
      background: transparent;
      border: 0;
      cursor: pointer;
      position: relative;
    }

    .nav-toggle span {
      position: absolute;
      left: 8px;
      right: 8px;
      height: 2px;
      background: #000;
      border-radius: 2px;
    }

    .nav-toggle span:nth-child(1) {
      top: 12px;
    }

    .nav-toggle span:nth-child(2) {
      top: 21px;
    }

    .nav-toggle span:nth-child(3) {
      top: 30px;
    }

    .nav-toggle.is-active span:nth-child(1) {
      transform: translateY(9px) rotate(45deg);
    }

    .nav-toggle.is-active span:nth-child(2) {
      opacity: 0;
    }

    .nav-toggle.is-active span:nth-child(3) {
      transform: translateY(-9px) rotate(-45deg);
    }

    /* Mobile breakpoint */
    @media (max-width: 1024px) {
      .site-header {
        height: 90px;
      }

      .site-header-inner {
        grid-template-columns: auto 1fr auto;
        padding: 0 var(--container-pad-tablet);
        height: 90px;
      }

      .site-nav {
        display: none;
      }

      .nav-toggle {
        display: inline-flex;
      }

      .site-logo img {
        height: 58px;
      }

      /* dropdowns not used on hover for mobile */
      .dropdown {
        position: static;
        width: 100%;
        transform: none;
        opacity: 1;
        visibility: visible;
        pointer-events: auto;
        box-shadow: none;
        border-radius: 0;
      }
    }

    /* ===============================
   MOBILE OFFCANVAS NAV
   =============================== */
    .mobile-nav {
      position: fixed;
      inset: 0;
      display: flex;
      justify-content: flex-end;
      background: rgba(0, 0, 0, 0.4);
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }

    .mobile-nav.is-open {
      opacity: 1;
      pointer-events: auto;
    }

    .mobile-nav-inner {
      width: min(80vw, 340px);
      max-width: 400px;
      background: var(--color-bg);
      padding: 24px 20px 32px;
      box-shadow: -4px 0 12px rgba(0, 0, 0, 0.15);
      transform: translateX(100%);
      transition: transform 0.2s ease;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .mobile-nav.is-open .mobile-nav-inner {
      transform: translateX(0);
    }

    .mobile-nav-close {
      align-self: flex-end;
      width: 40px;
      height: 40px;
      border: none;
      background: transparent;
      font-size: 24px;
      cursor: pointer;
    }

    .mobile-nav-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .mobile-nav-item {
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    }

    .mobile-nav-link {
      display: block;
      padding: 15px 0; /* approx 45px+ touch target */
      font-family: var(--font-body);
      font-size: 15px;
      font-weight: 400;
      text-transform: uppercase;
      text-decoration: none;
      color: #000;
    }

    .mobile-submenu {
      list-style: none;
      margin: 4px 0 8px;
      padding: 0 0 0 12px;
    }

    .mobile-submenu-link {
      display: block;
      padding: 15px 0; /* Safe touch target > 48px */
      font-size: 14px;
      text-decoration: none;
      color: var(--color-text);
    }

    @media (min-width: 1025px) {
      .mobile-nav {
        display: none;
      }
    }
  </style>
  <script>
    // Mobile nav
    const toggle = document.querySelector("[data-nav-toggle]");
    const closeBtn = document.querySelector("[data-nav-close]");
    const panel = document.querySelector("[data-mobile-nav]");
    const header = document.getElementById("site-header");

    function openNav() {
      if (!(panel instanceof HTMLElement) || !(toggle instanceof HTMLElement))
        return;
      panel.hidden = false;
      requestAnimationFrame(() => {
        panel.classList.add("is-open");
        toggle.classList.add("is-active");
      });
      toggle.setAttribute("aria-expanded", "true");
      document.body.classList.add("no-scroll");
    }

    function closeNav() {
      if (!(panel instanceof HTMLElement) || !(toggle instanceof HTMLElement))
        return;
      panel.classList.remove("is-open");
      toggle.classList.remove("is-active");
      toggle.setAttribute("aria-expanded", "false");
      document.body.classList.remove("no-scroll");
      setTimeout(() => (panel.hidden = true), 200);
    }

    toggle?.addEventListener("click", openNav);
    closeBtn?.addEventListener("click", closeNav);
    panel?.addEventListener("click", (e) => {
      if (e.target === panel) closeNav();
    });

    // Hide header on scroll down, show on scroll up
    // Hide header on scroll down, show on scroll up
    let lastScrollY = window.scrollY;
    const SCROLL_THRESHOLD = 80; // px before behavior kicks in
    let ticking = false;

    function updateHeader() {
      // 1. READ phase (Get geometric values)
      const currentY = window.scrollY;
      const scrolledPastThreshold = currentY > SCROLL_THRESHOLD;
      const mobileNavOpen = panel?.classList.contains("is-open");

      // Determine what state we WANT to be in
      let shouldBeScrolled = false;
      let shouldBeHidden = false;

      if (scrolledPastThreshold) {
        shouldBeScrolled = true;
      }

      if (mobileNavOpen) {
        // If nav is open, force visible
        shouldBeHidden = false;
      } else if (currentY > lastScrollY && scrolledPastThreshold) {
        // Scrolling down & past threshold -> Hide
        shouldBeHidden = true;
      } else {
        // Scrolling up or at top -> Show
        shouldBeHidden = false;
      }

      // Update state for next tick
      lastScrollY = currentY;
      ticking = false;

      // 2. WRITE phase (Mutate DOM based on calculated state)
      // We do this inside the same rAF callback, but after all reads are done.
      if (!header) return;

      if (shouldBeScrolled) {
        header.classList.add("is-scrolled");
      } else {
        header.classList.remove("is-scrolled");
      }

      if (shouldBeHidden) {
        header.classList.add("is-hidden");
      } else {
        header.classList.remove("is-hidden");
      }
    }

    window.addEventListener(
      "scroll",
      () => {
        // Throttle to requestAnimationFrame to align with browser repaint
        if (!ticking) {
          window.requestAnimationFrame(updateHeader);
          ticking = true;
        }
      },
      { passive: true },
    ); // Mark listener as passive for better scroll performance
  </script>
</header>
