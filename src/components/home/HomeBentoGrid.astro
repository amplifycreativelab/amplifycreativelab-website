---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

// Images
import eventCandid from "../../assets/images/home/event-photography-perth-corporate-party-candid.webp";
import steakDetail from "../../assets/images/home/food-photography-perth-gourmet-steak-detail.webp";
import distilleryProduct from "../../assets/images/home/product-photography-perth-luxury-packaging-distillery.webp";
import saucePour from "../../assets/images/home/commercial-food-styling-sauce-pour-action-shot.webp";
import platedDessert from "../../assets/images/home/fine-dining-photography-perth-plated-dessert.webp";
import bagelPrep from "../../assets/images/home/lifestyle-food-photography-salmon-bagel-preparation.webp";
import kitchenCouple from "../../assets/images/home/branding-photography-perth-lifestyle-kitchen-couple.webp";

type Layout = "tall" | "wide" | "full";

const imageLayoutConfig: Record<Layout, { widths: number[]; sizes: string }> = {
  tall: {
    widths: [320, 480, 640, 800, 960, 1200],
    sizes: "(max-width: 600px) 50vw, (max-width: 900px) 50vw, 33vw",
  },
  wide: {
    widths: [480, 768, 1024, 1280, 1600, 2000],
    sizes: "(max-width: 600px) 50vw, (max-width: 900px) 100vw, 66vw",
  },
  full: {
    widths: [640, 960, 1280, 1600, 2000, 2400],
    sizes: "100vw",
  },
};

type GalleryItem = {
  src: ImageMetadata;
  alt: string;
  layout: Layout;
  className?: string; // Optional class for layout fixes
};

const galleryItems = [
  // ROW 1
  {
    src: eventCandid,
    alt: "Candid event photography of a woman laughing with a glass of champagne at a function in Perth.",
    layout: "tall",
  },
  {
    src: distilleryProduct,
    alt: "High-end product photography showing black and gold foil packaging for Whipper Snapper Distillery.",
    layout: "wide",
  },

  // ROW 2 (Wide then Tall)
  {
    src: platedDessert,
    alt: "Artistic top-down shot of a gourmet yellow banana dessert and chocolate tuile for fine dining web design.",
    layout: "wide",
  },

  {
    src: saucePour,
    alt: "Action food photography of sauce being poured over a steak and broccolini dish, professionally styled.",
    layout: "tall",
  },

  // ROW 3
  {
    src: bagelPrep,
    alt: "Bright lifestyle photography showing hands spreading cream cheese on a smoked salmon bagel.",
    layout: "tall",
    className: "tablet-full",
  },
  {
    src: kitchenCouple,
    alt: "Commercial lifestyle shot of a couple preparing food in a modern kitchen, ideal for brand web design.",
    layout: "wide",
  },

  // ROW 4
  {
    src: steakDetail,
    alt: "Close-up macro shot of sliced steak, roasted potatoes, and garnishes for a restaurant menu.",
    layout: "full",
  },
] satisfies GalleryItem[];
---

<section class="gallery-section">
  <div class="gallery-inner">
    <header class="gallery-header">
      <div class="header-content">
        <span class="eyebrow">Selected Work</span>
        <h2>Visuals that build your brand.</h2>
        <p>
          We combine art direction, commercial-grade photography, and modern web
          design to help brands stand out in competitive markets. Our work
          supports restaurants, caf√©s, product makers, retailers, and
          service-based businesses throughout Western Australia.
        </p>
      </div>
      <a href="/portfolio/" class="view-all-link">View Full Portfolio &rarr;</a>
    </header>

    <div class="bento-grid">
      {
        galleryItems.map((item) => {
          const config = imageLayoutConfig[item.layout];

          return (
            <figure
              class={`bento-item type-${item.layout} ${item.className || ""}`}
            >
              <Image
                src={item.src}
                alt={item.alt}
                widths={config.widths}
                sizes={config.sizes}
                class="bento-image"
                loading="lazy"
                decoding="async"
              />
            </figure>
          );
        })
      }
    </div>

    <a href="/portfolio/" class="view-all-link view-all-link--mobile">
      View Full Portfolio &rarr;
    </a>
  </div>
</section>

<style>
  /* --- BASE STYLES --- */
  .gallery-section {
    padding: clamp(3rem, 5vw, 5rem) 3rem;
    background: var(--color-page-bg, #fef8eb);
  }

  .gallery-inner {
    width: min(100%, var(--container-max, 1490px));
    margin: 0 auto;
  }

  /* --- HEADER --- */
  .gallery-header {
    margin-bottom: 3rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 1.5rem;
  }

  .header-content {
    max-width: 700px;
    margin: 0 auto;
  }

  .eyebrow {
    display: block;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--color-text);
    margin-bottom: 0.75rem;
    font-weight: 700;
  }

  .gallery-header h2 {
    font-size: clamp(2rem, 4vw, 2.8rem);
    line-height: 1.1;
    margin: 0 0 1rem 0;
    color: #1a1a1a;
  }

  .gallery-header p {
    font-size: 1.1rem;
    line-height: 1.5;
    color: #555;
    margin: 0;
  }

  .view-all-link {
    text-decoration: none;
    color: #1a1a1a;
    font-weight: 500;
    font-size: 0.95rem;
    border-bottom: 1px solid currentColor;
    white-space: nowrap;
    margin-bottom: 5px;
  }

  .view-all-link--mobile {
    display: none;
    margin-top: 1.5rem;
  }

  /* --- DESKTOP GRID --- */
  .bento-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    align-items: stretch;
    grid-auto-rows: 400px; /* fixed tracks prevent masonry-like vertical holes */
    gap: 16px;
    grid-auto-flow: dense;
  }

  .bento-item {
    margin: 0;
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    background: #e0e0e0;
    height: auto;
  }

  .bento-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.5s ease;
  }

  .bento-item:hover .bento-image {
    transform: scale(1.05);
  }

  /* Desktop Spans */
  .type-wide {
    grid-column: span 2;
  }
  .type-tall {
    grid-column: span 1;
  }
  .type-full {
    grid-column: 1 / -1;
  }

  /* --- TABLET (Simplifying) --- */
  @media (max-width: 900px) {
    .bento-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
      grid-auto-rows: 300px;
    }

    .type-wide,
    .type-full {
      grid-column: 1 / -1;
    }
  }

  /* --- TABLET SPECIFIC FIXES (601px - 900px) --- */
  @media (min-width: 601px) and (max-width: 900px) {
    /* Fix for orphaned tall item in row 4 causing layout gap */
    .tablet-full {
      grid-column: span 2 !important;
    }
  }

  /* --- MOBILE (The "Instagram" Grid) --- */
  @media (max-width: 600px) {
    /* .gallery-header alignment handled by base styles now */

    .bento-grid {
      grid-template-columns: repeat(2, 1fr); /* Force 2 columns */
      grid-auto-rows: auto; /* allow square/feature ratios below */
      gap: 10px;
      padding-bottom: 0;
    }

    /* Reset ALL spans to 1x1 squares */
    .type-wide,
    .type-tall {
      grid-column: span 1;
      aspect-ratio: 1 / 1;
    }

    /* Keep the feature image full width */
    .type-full {
      grid-column: 1 / -1;
      aspect-ratio: 16 / 9;
    }

    .bento-item {
      /* --- THIS IS THE MISSING FIX --- */
      min-width: 0; /* 1. Allows the box to shrink smaller than the image inside it */
      width: 100%; /* 2. Ensures it fills the grid cell exactly */
      /* ------------------------------- */

      border-radius: 8px;
    }

    /* Hide the header button on mobile */
    .gallery-header .view-all-link {
      display: none;
    }

    .view-all-link--mobile {
      display: inline-block;
      font-size: 0.85rem; /* Slightly smaller */
      margin-top: 2rem;
    }
  }
</style>
