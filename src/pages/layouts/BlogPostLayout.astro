---
import BaseLayout from "./BaseLayout.astro";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

export interface FaqItem {
  question: string;
  answer: string;
}

export interface BlogPost {
  title: string;
  description: string;
  publishDate: string;
  author?: string;
  category?: string;
  readTime?: string;
  // Supports both local image imports (ImageMetadata) and URL strings
  featuredImage?: ImageMetadata | string;
  featuredImageAlt?: string;
  tags?: string[];
  canonicalUrl?: string;
  featuredImagePosition?: string;
  // GEO Enhancement Fields
  updatedDate?: string;
  faq?: FaqItem[];
}

const {
  title,
  description,
  publishDate,
  author = "Amplify Creative Lab",
  category = "Photography",
  readTime = "5 min read",
  featuredImage,
  tags = [],
  canonicalUrl = "https://amplifycreativelab.com",
  featuredImagePosition = "center center",
  // GEO Enhancement Fields
  updatedDate,
  faq,
} = Astro.props as BlogPost;

const blogSchema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  headline: title,
  description,
  datePublished: publishDate,
  dateModified: updatedDate || publishDate,
  author: {
    "@type": "Organization",
    name: author,
  },
  publisher: {
    "@type": "Organization",
    name: "Amplify Creative Lab",
    logo: {
      "@type": "ImageObject",
      url: "https://amplifycreativelab.com/images/logo/logo-web.png",
    },
  },
  mainEntityOfPage: {
    "@type": "WebPage",
    "@id": canonicalUrl,
  },
};

// Generate FAQPage schema if faq data is provided (GEO optimization)
const faqSchema =
  faq && faq.length > 0
    ? {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        mainEntity: faq.map((item) => ({
          "@type": "Question",
          name: item.question,
          acceptedAnswer: {
            "@type": "Answer",
            text: item.answer,
          },
        })),
      }
    : null;

// Generate Breadcrumb schema for navigation trails in SERPs
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  itemListElement: [
    {
      "@type": "ListItem",
      position: 1,
      name: "Home",
      item: "https://amplifycreativelab.com/",
    },
    {
      "@type": "ListItem",
      position: 2,
      name: "Blog",
      item: "https://amplifycreativelab.com/blog/",
    },
    {
      "@type": "ListItem",
      position: 3,
      name: title,
      item: canonicalUrl,
    },
  ],
};

const encodedUrl = encodeURIComponent(canonicalUrl);
const encodedTitle = encodeURIComponent(title);
---

<BaseLayout title={title} description={description} canonical={canonicalUrl}>
  <main class="blog-page">
    <article
      class="blog-article"
      itemscope
      itemtype="https://schema.org/BlogPosting"
    >
      {
        featuredImage && (
          <div class="blog-hero">
            {typeof featuredImage === "string" ? (
              <img
                src={featuredImage}
                alt={Astro.props.featuredImageAlt ?? title}
                class="blog-hero-image"
                loading="eager"
                decoding="async"
                width="600"
                height="750"
                style={`object-fit: cover; object-position: ${featuredImagePosition};`}
              />
            ) : (
              <Image
                src={featuredImage}
                alt={Astro.props.featuredImageAlt ?? title}
                class="blog-hero-image"
                loading="eager"
                decoding="async"
                width={600}
                height={750}
                style={`object-fit: cover; object-position: ${featuredImagePosition};`}
              />
            )}
          </div>
        )
      }

      <header class="blog-header">
        <div class="blog-meta-top">
          {category && <span class="blog-category">{category}</span>}
        </div>

        <h1 class="blog-title" itemprop="headline">
          {title}
        </h1>

        <div class="blog-meta">
          <time
            class="blog-date"
            datetime={publishDate}
            itemprop="datePublished"
          >
            {
              new Date(publishDate).toLocaleDateString("en-AU", {
                year: "numeric",
                month: "long",
                day: "numeric",
              })
            }
          </time>

          <span class="blog-dot">•</span>

          <span class="blog-author" itemprop="author">
            {author}
          </span>

          {
            readTime && (
              <>
                <span class="blog-dot">•</span>
                <span class="blog-readtime">{readTime}</span>
              </>
            )
          }
        </div>

        {
          updatedDate && updatedDate !== publishDate && (
            <time
              class="blog-updated"
              datetime={updatedDate}
              itemprop="dateModified"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                aria-hidden="true"
              >
                <circle cx="12" cy="12" r="10" />
                <polyline points="12 6 12 12 16 14" />
              </svg>
              Last updated:{" "}
              {new Date(updatedDate).toLocaleDateString("en-AU", {
                day: "numeric",
                month: "long",
                year: "numeric",
              })}
            </time>
          )
        }

        {
          tags.length > 0 && (
            <ul class="blog-tags">
              {tags.map((tag) => (
                <li class="blog-tag">{tag}</li>
              ))}
            </ul>
          )
        }
      </header>

      <section class="blog-content" itemprop="articleBody">
        <slot />
      </section>

      <footer class="blog-footer">
        <section class="blog-share">
          <p class="blog-share-label">Share this article</p>
          <div class="blog-share-buttons">
            <a
              href={`https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`}
              target="_blank"
              rel="noopener noreferrer"
              class="share-btn share-btn--facebook"
            >
              Facebook
            </a>
            <a
              href={`https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedTitle}`}
              target="_blank"
              rel="noopener noreferrer"
              class="share-btn share-btn--twitter"
            >
              X (Twitter)
            </a>
            <a
              href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodedUrl}`}
              target="_blank"
              rel="noopener noreferrer"
              class="share-btn share-btn--linkedin"
            >
              LinkedIn
            </a>
            <a
              href={`https://pinterest.com/pin/create/button/?url=${encodedUrl}&description=${encodedTitle}`}
              target="_blank"
              rel="noopener noreferrer"
              class="share-btn share-btn--pinterest"
            >
              Pinterest
            </a>
          </div>
        </section>

        <section class="blog-cta">
          <h2 class="blog-cta-title">
            Want photography like this for your restaurant?
          </h2>
          <p class="blog-cta-text">
            We help Perth restaurants, cafés and bars create mouth-watering
            images that turn browsers into bookings.
          </p>
          <a href="/contact/" class="blog-cta-button">
            Let’s plan your shoot →
          </a>
        </section>
      </footer>
    </article>
  </main>

  <script type="application/ld+json" set:html={JSON.stringify(blogSchema)} />
  <script
    type="application/ld+json"
    set:html={JSON.stringify(breadcrumbSchema)}
  />
  {
    faqSchema && (
      <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
    )
  }
</BaseLayout>

<style>
  .blog-page {
    padding-inline: clamp(1.5rem, 5vw, 4rem);
    padding-block: clamp(3rem, 6vw, 4.5rem);
    background-color: #fef8eb;
  }

  .blog-article {
    max-width: 1200px;
    margin: 0 auto;
  }

  .blog-hero {
    max-width: clamp(320px, 80vw, 720px);
    margin-inline: auto;
    margin-bottom: clamp(2rem, 4vw, 2.5rem);
    border-radius: 16px;
    overflow: hidden;
    aspect-ratio: 4 / 5;
  }

  .blog-hero-image {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .blog-header {
    margin-bottom: clamp(2rem, 4vw, 2.5rem);
  }

  .blog-meta-top {
    margin-bottom: 0.75rem;
  }

  .blog-category {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    font-size: 0.75rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    background-color: #24360f;
    color: #fef8eb;
  }

  .blog-title {
    font-family:
      "Abril Fatface",
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      sans-serif;
    font-size: clamp(2.4rem, 4vw, 3rem);
    line-height: 1.1;
    color: #152705;
    margin-bottom: 0.75rem;
  }

  .blog-meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.4rem;
    font-family:
      "Montserrat",
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      sans-serif;
    font-size: 0.85rem;
    color: #55624a;
  }

  .blog-dot {
    opacity: 0.6;
  }

  .blog-updated {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-family:
      "Montserrat",
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      sans-serif;
    font-size: 0.8rem;
    color: #6b7c5a;
    margin-top: 0.5rem;
    padding: 0.4rem 0.8rem;
    background-color: rgba(107, 124, 90, 0.1);
    border-radius: 999px;
    width: fit-content;
  }

  .blog-updated svg {
    flex-shrink: 0;
  }

  .blog-tags {
    list-style: none;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
    padding: 0;
  }

  .blog-tag {
    font-size: 0.75rem;
    padding: 0.3rem 0.8rem;
    border-radius: 999px;
    border: 1px solid #d9c6a4;
    color: #7b5b33;
    background-color: #fffaf1;
  }

  .blog-content {
    font-family:
      "Darker Grotesque",
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      sans-serif;
    font-size: 1.3rem;
    line-height: 1.6;
    color: #24360f;
  }

  .blog-content p {
    margin-bottom: 1.2rem;
  }

  .blog-content h2 {
    font-family:
      "Montserrat",
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      sans-serif;
    font-size: 1.5rem;
    font-weight: 600;
    text-transform: none;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    color: #152705;
  }

  .blog-content h3 {
    font-family:
      "Montserrat",
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      sans-serif;
    font-size: 1.2rem;
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    color: #24360f;
  }

  .blog-content ul,
  .blog-content ol {
    margin-left: 1.5rem;
    margin-bottom: 1.2rem;
    padding-left: 0.5rem;
  }

  .blog-content li {
    margin-bottom: 0.4rem;
  }

  .blog-content strong {
    font-weight: 600;
    color: #152705;
  }

  .blog-footer {
    margin-top: clamp(3rem, 6vw, 3.5rem);
    border-top: 1px solid #e3d4b4;
    padding-top: clamp(2rem, 4vw, 2.5rem);
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
  }

  .blog-share-label {
    font-family:
      "Montserrat",
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      sans-serif;
    font-size: 0.9rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #7b5b33;
    margin-bottom: 0.75rem;
  }

  .blog-share-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
  }

  .share-btn {
    font-family:
      "Montserrat",
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      sans-serif;
    font-size: 0.85rem;
    padding: 0.5rem 0.9rem;
    border-radius: 999px;
    border: 1px solid #d4c5a5;
    background-color: #fffaf1;
    color: #24360f;
    text-decoration: none;
    transition:
      background-color 0.2s ease,
      transform 0.1s ease;
  }

  .share-btn:hover {
    background-color: #f0e1c3;
    transform: translateY(-1px);
  }

  .blog-cta {
    padding: 1.75rem 1.75rem 2rem;
    border-radius: 16px;
    background: #24360f;
    color: #fef8eb;
  }

  .blog-cta-title {
    font-family:
      "Montserrat",
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      sans-serif;
    font-size: 1.4rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
  }

  .blog-cta-text {
    font-family:
      "Darker Grotesque",
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      sans-serif;
    font-size: 1.05rem;
    margin-bottom: 1.1rem;
  }

  .blog-cta-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.7rem 1.4rem;
    border-radius: 999px;
    border: 1px solid #fef8eb;
    color: #24360f;
    background-color: #fef8eb;
    font-family:
      "Montserrat",
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      sans-serif;
    font-size: 0.95rem;
    font-weight: 600;
    text-decoration: none;
    transition:
      background-color 0.2s ease,
      transform 0.1s ease;
  }

  .blog-cta-button:hover {
    background-color: #e4e2de;
    transform: translateY(-1px);
  }

  @media (max-width: 768px) {
    .blog-page {
      padding-inline: 1.25rem;
      padding-block: 2.5rem;
    }

    .blog-cta {
      padding: 1.5rem 1.25rem 1.75rem;
    }
  }
</style>
